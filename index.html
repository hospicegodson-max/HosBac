<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HosBac - Épreuves et corrigés du BAC</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <style>
        :root {
            --primary-blue: #1a237e;
            --deep-blue: #0d1452;
            --light-blue: #5c6bc0;
            --white: #ffffff;
            --red: #e53935;
            --light-gray: #f5f5f5;
            --dark-gray: #424242;
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-blue), var(--deep-blue));
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-blue), var(--deep-blue));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.8s ease;
        }

        .splash-logo {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            transform: rotate(-5deg);
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .splash-icons {
            display: flex;
            gap: 1.5rem;
            font-size: 2.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 20px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5);
        }

        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(26, 35, 126, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            transform: rotate(-3deg);
        }

        .nav-icons {
            display: flex;
            gap: 20px;
        }

        .nav-icon {
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 50%;
        }

        .nav-icon:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .nav-icon.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .page {
            display: none;
            padding: 30px 0;
            min-height: calc(100vh - 120px);
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 25px;
            text-align: center;
        }

        .exams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .exam-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 20px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5);
        }

        .exam-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--white);
        }

        .exam-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .exam-actions {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
        }

        .btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--light-blue);
            color: var(--white);
        }

        .btn-primary:hover {
            background: #3949ab;
        }

        .btn-success {
            background: #43a047;
            color: var(--white);
        }

        .btn-success:hover {
            background: #2e7d32;
        }

        .btn-danger {
            background: var(--red);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c62828;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--light-blue);
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            font-size: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23ffffff' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 10px;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-content {
            flex: 1;
        }

        .notification-actions {
            display: flex;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        footer {
            background: rgba(13, 20, 82, 0.9);
            padding: 30px 0;
            margin-top: 50px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .footer-logo {
            font-size: 1.8rem;
            font-weight: 700;
            transform: rotate(-3deg);
        }

        .footer-contact {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .social-links {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .social-link {
            font-size: 1.5rem;
            color: var(--white);
            transition: all 0.3s ease;
        }

        .social-link:hover {
            transform: scale(1.2);
        }

        .legal-links {
            display: flex;
            gap: 20px;
        }

        .legal-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .legal-link:hover {
            color: var(--white);
        }

        .admin-badge {
            background: var(--red);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 5px;
        }

        .points-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab.active {
            background: var(--light-blue);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .exams-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .nav-icons {
                gap: 15px;
            }
            
            .nav-icon {
                font-size: 1.2rem;
            }
            
            .page-title {
                font-size: 1.7rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">HosBac</div>
        <div class="splash-icons">
            <i class="fas fa-book"></i>
            <i class="fas fa-pencil-alt"></i>
            <i class="fas fa-school"></i>
            <i class="fas fa-graduation-cap"></i>
            <i class="fas fa-search"></i>
        </div>
    </div>

    <!-- Modal d'Avertissement -->
    <div class="modal" id="warningModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Avertissement</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>En utilisant HosBac, vous acceptez nos Conditions Générales d'Utilisation et notre Politique de Confidentialité.</p>
                <p>Vous devez avoir au moins 13 ans pour utiliser cette plateforme.</p>
                <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                    <button class="btn btn-primary" id="acceptWarning">J'accepte</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">HosBac</div>
            <div class="nav-icons">
                <div class="nav-icon" data-page="home"><i class="fas fa-home"></i></div>
                <div class="nav-icon" data-page="notifications"><i class="fas fa-bell"></i></div>
                <div class="nav-icon" data-page="exams"><i class="fas fa-file-alt"></i></div>
                <div class="nav-icon" data-page="search"><i class="fas fa-search"></i></div>
                <div class="nav-icon" data-page="profile"><i class="fas fa-user"></i></div>
                <div class="nav-icon admin-only" data-page="admin" style="display: none;"><i class="fas fa-cog"></i></div>
            </div>
            <div class="points-display" id="pointsDisplay" style="display: none;">
                <i class="fas fa-coins"></i>
                <span id="pointsValue">0</span> points
            </div>
        </div>
    </header>

    <!-- Pages -->
    <main class="container">
        <!-- Page d'accueil -->
        <div class="page active" id="home">
            <h1 class="page-title">Épreuves récentes</h1>
            <div class="exams-grid" id="homeExamsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- Page des notifications -->
        <div class="page" id="notifications">
            <h1 class="page-title">Notifications</h1>
            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Vos alertes</h2>
                    <button class="btn btn-secondary" id="clearAllNotifications">
                        <i class="fas fa-trash"></i> Tout supprimer
                    </button>
                </div>
                <div id="notificationsList">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page des examens -->
        <div class="page" id="exams">
            <h1 class="page-title">Catalogue des épreuves</h1>
            <div class="tab-container">
                <div class="tab active" data-filter="all">Toutes</div>
                <div class="tab" data-filter="mathematique">Mathématique</div>
                <div class="tab" data-filter="francais">Français</div>
                <div class="tab" data-filter="svt">SVT</div>
                <div class="tab" data-filter="pct">PCT</div>
                <div class="tab" data-filter="anglais">Anglais</div>
                <div class="tab" data-filter="philo">Philo</div>
            </div>
            <div class="exams-grid" id="examsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" id="addExamBtn">
                    <i class="fas fa-plus"></i> Ajouter une épreuve
                </button>
            </div>
        </div>

        <!-- Page de recherche -->
        <div class="page" id="search">
            <h1 class="page-title">Recherche</h1>
            <div class="glass-card">
                <div class="form-group">
                    <input type="text" class="form-control" id="searchInput" placeholder="Rechercher par nom, matière, classe...">
                </div>
                <div class="exams-grid" id="searchResults">
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>Utilisez la barre de recherche pour trouver des épreuves</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page de profil -->
        <div class="page" id="profile">
            <h1 class="page-title">Mon Profil</h1>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="userPoints">0</div>
                    <div class="stat-label">Points</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="userExams">0</div>
                    <div class="stat-label">Épreuves publiées</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="userDownloads">0</div>
                    <div class="stat-label">Téléchargements</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="userFavorites">0</div>
                    <div class="stat-label">Favoris reçus</div>
                </div>
            </div>
            
            <div class="glass-card" style="margin-bottom: 20px;">
                <h2 style="margin-bottom: 15px;">Informations personnelles</h2>
                <div id="userInfo">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
                <button class="btn btn-secondary" id="editProfileBtn" style="margin-top: 15px;">
                    <i class="fas fa-edit"></i> Modifier le profil
                </button>
            </div>
            
            <div class="glass-card">
                <h2 style="margin-bottom: 15px;">Mes favoris</h2>
                <div id="userFavoritesList">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-danger" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </div>

        <!-- Page d'administration -->
        <div class="page" id="admin">
            <h1 class="page-title">Administration <span class="admin-badge">Admin</span></h1>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="adminUsers">0</div>
                    <div class="stat-label">Utilisateurs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="adminExams">0</div>
                    <div class="stat-label">Épreuves totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="adminPending">0</div>
                    <div class="stat-label">En attente</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="adminDownloads">0</div>
                    <div class="stat-label">Téléchargements</div>
                </div>
            </div>
            
            <div class="glass-card" style="margin-top: 30px;">
                <h2 style="margin-bottom: 20px;">Modération des épreuves</h2>
                <div id="adminExamsList">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="footer-logo">HosBac</div>
            <div class="footer-contact">
                <div>Email: mickaelpcs14@gmail.com</div>
                <div>Téléphone: +229 01 98 86 07 52</div>
            </div>
            <div class="social-links">
                <a href="https://www.facebook.com/profile.php?id=61579985138308" class="social-link" target="_blank">
                    <i class="fab fa-facebook"></i>
                </a>
                <a href="https://wa.me/qr/73EC225KOITDD1" class="social-link" target="_blank">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
            <div class="legal-links">
                <a href="#" class="legal-link" id="termsLink">Conditions d'utilisation</a>
                <a href="#" class="legal-link" id="privacyLink">Politique de confidentialité</a>
            </div>
        </div>
    </footer>

    <!-- Modales -->
    
    <!-- Modal de connexion -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Connexion</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Mot de passe</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <div style="text-align: right; margin-bottom: 15px;">
                        <a href="#" id="forgotPasswordLink" style="color: var(--light-blue); text-decoration: none;">Mot de passe oublié?</a>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Se connecter</button>
                </form>
                <div style="text-align: center; margin-top: 15px;">
                    <p>Pas de compte? <a href="#" id="showRegisterLink" style="color: var(--light-blue); text-decoration: none;">S'inscrire</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal d'inscription -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Inscription</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label" for="registerName">Nom complet</label>
                        <input type="text" class="form-control" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerEmail">Email</label>
                        <input type="email" class="form-control" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerSchool">École</label>
                        <input type="text" class="form-control" id="registerSchool" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerClass">Classe</label>
                        <select class="form-select" id="registerClass" required>
                            <option value="">Sélectionnez votre classe</option>
                            <option value="6ème">6ème</option>
                            <option value="5ème">5ème</option>
                            <option value="4ème">4ème</option>
                            <option value="3ème">3ème</option>
                            <option value="2nde">2nde</option>
                            <option value="1ère">1ère</option>
                            <option value="Terminale">Terminale</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerPassword">Mot de passe</label>
                        <input type="password" class="form-control" id="registerPassword" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerConfirmPassword">Confirmer le mot de passe</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">S'inscrire</button>
                </form>
                <div style="text-align: center; margin-top: 15px;">
                    <p>Déjà un compte? <a href="#" id="showLoginLink" style="color: var(--light-blue); text-decoration: none;">Se connecter</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal d'ajout d'épreuve -->
    <div class="modal" id="addExamModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ajouter une épreuve</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addExamForm">
                    <div class="form-group">
                        <label class="form-label" for="examSubject">Matière</label>
                        <select class="form-select" id="examSubject" required>
                            <option value="">Sélectionnez une matière</option>
                            <option value="Mathématique">Mathématique</option>
                            <option value="Français">Français</option>
                            <option value="SVT">SVT</option>
                            <option value="PCT">PCT</option>
                            <option value="Espagnol">Espagnol</option>
                            <option value="HG">HG</option>
                            <option value="Allemand">Allemand</option>
                            <option value="Économie">Économie</option>
                            <option value="Anglais">Anglais</option>
                            <option value="Comptabilité">Comptabilité</option>
                            <option value="T-bad">T-bad</option>
                            <option value="Philo">Philo</option>
                            <option value="Droit">Droit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="examClass">Classe/Série</label>
                        <input type="text" class="form-control" id="examClass" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="examName">Nom de l'épreuve</label>
                        <input type="text" class="form-control" id="examName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="examFile">Fichier PDF Épreuve</label>
                        <input type="file" class="form-control" id="examFile" accept=".pdf" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="corrigeFile">Fichier PDF Corrigé (facultatif)</label>
                        <input type="file" class="form-control" id="corrigeFile" accept=".pdf">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Soumettre</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de modification de profil -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Modifier le profil</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="form-group">
                        <label class="form-label" for="editName">Nom complet</label>
                        <input type="text" class="form-control" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editSchool">École</label>
                        <input type="text" class="form-control" id="editSchool" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editClass">Classe</label>
                        <select class="form-select" id="editClass" required>
                            <option value="">Sélectionnez votre classe</option>
                            <option value="6ème">6ème</option>
                            <option value="5ème">5ème</option>
                            <option value="4ème">4ème</option>
                            <option value="3ème">3ème</option>
                            <option value="2nde">2nde</option>
                            <option value="1ère">1ère</option>
                            <option value="Terminale">Terminale</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Enregistrer</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Conditions d'utilisation -->
    <div class="modal" id="termsModal">
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">Conditions Générales d'Utilisation</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="color: rgba(255, 255, 255, 0.9); line-height: 1.6;">
                    <p><strong>Dernière mise à jour : 26/10/2025</strong></p>
                    <p>Bienvenue sur HosBac ! En accédant à notre site web et en utilisant nos services, vous acceptez d'être lié par les présentes Conditions Générales d'Utilisation (CGU).</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">1. Objet de la Plateforme</h3>
                    <p>HosBac est une plateforme éducative conçue pour aider les élèves et étudiants (du Collège au Lycée, classes de 6ème à la Terminale, et préparant le BEPC et le BAC) en leur donnant accès à des épreuves, examens et corrigés. Les utilisateurs peuvent consulter, télécharger et publier des ressources pédagogiques.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">2. Inscription et Compte Utilisateur</h3>
                    <p><strong>Création de compte :</strong> Pour accéder à certaines fonctionnalités (comme les favoris ou la publication), vous devez créer un compte en fournissant des informations exactes (Nom, Prénom, Email, Mot de passe).</p>
                    <p><strong>Sécurité :</strong> Vous êtes responsable de la confidentialité de votre mot de passe et de toutes les activités effectuées depuis votre compte.</p>
                    <p><strong>Âge :</strong> Vous devez avoir l'âge légal requis dans votre pays pour créer un compte, ou obtenir l'autorisation de vos parents ou tuteurs légaux.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">3. Publication de Contenu par les Utilisateurs</h3>
                    <p><strong>Propriété du contenu :</strong> En publiant une épreuve ou un corrigé (ci-après "le Contenu") sur HosBac, vous déclarez et garantissez que :</p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>Vous êtes l'auteur de ce Contenu, ou ;</li>
                        <li>Vous disposez de toutes les autorisations et droits nécessaires (notamment les droits d'auteur) pour le publier et nous accorder une licence d'utilisation.</li>
                    </ul>
                    <p><strong>Licence accordée :</strong> Vous nous accordez une licence non exclusive, mondiale et gratuite pour héberger, afficher, reproduire et distribuer votre Contenu sur la plateforme.</p>
                    <p><strong>Contenu interdit :</strong> Il est interdit de publier du Contenu illégal, diffamatoire, haineux, ou portant atteinte aux droits de tiers.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">4. Modération et Approbation</h3>
                    <p><strong>Rôle de l'Administrateur :</strong> L'administrateur de HosBac (ci-après "l'Administrateur") se réserve le droit d'examiner tout Contenu soumis.</p>
                    <p><strong>Approbation :</strong> Le Contenu ne sera visible publiquement qu'après approbation par l'Administrateur.</p>
                    <p><strong>Refus ou Retrait :</strong> L'Administrateur peut refuser ou retirer tout Contenu, à tout moment et sans préavis, s'il estime qu'il ne respecte pas les présentes CGU, qu'il est de mauvaise qualité, ou pour toute autre raison, à sa seule discrétion.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">5. Responsabilité</h3>
                    <p><strong>Exactitude du Contenu :</strong> HosBac ne garantit pas l'exactitude, la pertinence ou l'exhaustivité des épreuves et corrigés publiés par les utilisateurs. Nous agissons en tant qu'hébergeur.</p>
                    <p><strong>Limitation de responsabilité :</strong> L'utilisation de la plateforme se fait à vos propres risques. Nous ne serons pas tenus responsables des dommages directs ou indirects résultant de l'utilisation du site.</p>
                    <p><strong>Responsabilité de l'utilisateur :</strong> Vous êtes seul responsable du Contenu que vous publiez et des conséquences de sa diffusion.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">6. Propriété Intellectuelle</h3>
                    <p>Tous les éléments constituant la plateforme (logo, design, structure) sont la propriété exclusive de HosBac. Le contenu pédagogique reste la propriété de ses auteurs respectifs, sous réserve de la licence accordée à la plateforme (voir article 3).</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">7. Modification des CGU</h3>
                    <p>Nous nous réservons le droit de modifier ces CGU à tout moment. Les modifications prendront effet dès leur publication sur le site.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">8. Droit applicable</h3>
                    <p>Les présentes CGU sont régies par le droit Bénin.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">9. Contact</h3>
                    <p>Pour toute question relative à ces CGU, veuillez nous contacter à HosBac.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Politique de confidentialité -->
    <div class="modal" id="privacyModal">
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">Politique de Confidentialité</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="color: rgba(255, 255, 255, 0.9); line-height: 1.6;">
                    <p><strong>Dernière mise à jour : 26/10/2025</strong></p>
                    <p>La protection de vos données personnelles est une priorité pour HosBac. Cette politique décrit quelles informations nous collectons et comment nous les utilisons.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">1. Quelles données collectons-nous ?</h3>
                    <p>Nous collectons deux types d'informations :</p>
                    <p><strong>Données fournies lors de l'inscription :</strong></p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>Nom et Prénom</li>
                        <li>Adresse email</li>
                        <li>Mot de passe (stocké de manière chiffrée/hachée)</li>
                    </ul>
                    <p><strong>Données générées par votre activité :</strong></p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>Les épreuves que vous mettez en favoris.</li>
                        <li>Votre historique d'activité (épreuves consultées).</li>
                        <li>Les épreuves que vous publiez (fichiers PDF et métadonnées associées : matière, classe, série).</li>
                        <li>Données techniques (adresse IP, type de navigateur) via des outils d'analyse (comme Firebase Analytics) pour améliorer le service.</li>
                    </ul>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">2. Pourquoi collectons-nous ces données (Finalités) ?</h3>
                    <p>Vos données sont utilisées pour :</p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><strong>Fournir le service :</strong> Créer et gérer votre compte, vous permettre de vous connecter et de récupérer votre mot de passe.</li>
                        <li><strong>Personnaliser votre expérience :</strong> Afficher votre ID, votre nom, et vous donner accès à vos favoris et activités récentes.</li>
                        <li><strong>Gérer le Contenu :</strong> Permettre la publication, la modération et l'affichage des épreuves.</li>
                        <li><strong>Améliorer la plateforme :</strong> Analyser l'utilisation du site pour corriger les bugs et développer de nouvelles fonctionnalités.</li>
                        <li><strong>Sécurité :</strong> Protéger la plateforme contre la fraude et les abus.</li>
                    </ul>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">3. Partage des données</h3>
                    <p>Nous ne vendons ni ne louons vos données personnelles à des tiers.</p>
                    <p>Vos données peuvent être partagées avec :</p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><strong>Les autres utilisateurs :</strong> Votre nom ou pseudo peut être visible si vous publiez une épreuve.</li>
                        <li><strong>Nos fournisseurs techniques :</strong> Nous utilisons des services tiers pour faire fonctionner la plateforme, notamment pour l'hébergement, l'authentification et l'analyse (par exemple, Firebase). Ces fournisseurs n'ont accès à vos données que pour exécuter ces tâches en notre nom.</li>
                        <li><strong>Obligations légales :</strong> Si la loi l'exige.</li>
                    </ul>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">4. Sécurité des données</h3>
                    <p>Nous mettons en œuvre des mesures de sécurité techniques (comme le chiffrage) et organisationnelles pour protéger vos données contre la perte, l'accès non autorisé ou la modification. Nous nous appuyons sur les mesures de sécurité fournies par Google/Firebase pour l'infrastructure de base de données et d'authentification.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">5. Conservation des données</h3>
                    <p>Nous conservons vos données personnelles tant que votre compte est actif. Si vous supprimez votre compte, vos données personnelles (nom, email) seront supprimées dans un délai raisonnable. Les contenus (épreuves) que vous avez publiés pourront être conservés de manière anonyme.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">6. Vos droits</h3>
                    <p>Conformément à la législation en vigueur, vous disposez d'un droit :</p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><strong>D'accès :</strong> Consulter les données que nous avons sur vous (via votre profil).</li>
                        <li><strong>De rectification :</strong> Modifier vos informations inexactes (via votre profil).</li>
                        <li><strong>De suppression ("droit à l'oubli") :</strong> Demander la suppression de votre compte et de vos données.</li>
                    </ul>
                    <p>Pour exercer ces droits, vous pouvez nous contacter à mickaelpcs14@gmail.com.</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">7. Cookies</h3>
                    <p>Notre site utilise des cookies (petits fichiers stockés sur votre navigateur) nécessaires à son bon fonctionnement (ex: maintenir votre session connectée) et pour les analyses de trafic (ex: Firebase Analytics).</p>
                    
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">8. Contact</h3>
                    <p>Pour toute question sur cette Politique de Confidentialité, contactez l'Administrateur à mickaelpcs14@gmail.com via les liens de contact (WhatsApp, Facebook) disponibles sur le site.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCgC2vbsKExHbZVc80b3jMq96besCMwjWk",
            authDomain: "hosbac-729f3.firebaseapp.com",
            projectId: "hosbac-729f3",
            storageBucket: "hosbac-729f3.firebasestorage.app",
            messagingSenderId: "577940206427",
            appId: "1:577940206427:web:9416d06adb40d28fb3a07e",
            measurementId: "G-LSX382NTGN"
        };

        // Initialisation Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const analytics = firebase.analytics();

        // Configuration Cloudinary
        const cloudName = 'dvlvj9zko';
        const uploadPreset = 'hosbac_pdf_upload';

        // Variables globales
        let currentUser = null;
        let userData = null;
        let exams = [];
        let notifications = [];

        // Éléments DOM
        const splashScreen = document.getElementById('splashScreen');
        const warningModal = document.getElementById('warningModal');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const addExamModal = document.getElementById('addExamModal');
        const editProfileModal = document.getElementById('editProfileModal');
        const termsModal = document.getElementById('termsModal');
        const privacyModal = document.getElementById('privacyModal');
        const pointsDisplay = document.getElementById('pointsDisplay');
        const pointsValue = document.getElementById('pointsValue');
        const homeExamsGrid = document.getElementById('homeExamsGrid');
        const examsGrid = document.getElementById('examsGrid');
        const searchResults = document.getElementById('searchResults');
        const notificationsList = document.getElementById('notificationsList');
        const userInfo = document.getElementById('userInfo');
        const userFavoritesList = document.getElementById('userFavoritesList');
        const adminExamsList = document.getElementById('adminExamsList');
        const userPoints = document.getElementById('userPoints');
        const userExams = document.getElementById('userExams');
        const userDownloads = document.getElementById('userDownloads');
        const userFavorites = document.getElementById('userFavorites');
        const adminUsers = document.getElementById('adminUsers');
        const adminExams = document.getElementById('adminExams');
        const adminPending = document.getElementById('adminPending');
        const adminDownloads = document.getElementById('adminDownloads');

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            // Afficher l'écran de démarrage pendant 4 secondes
            setTimeout(() => {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    
                    // Vérifier si l'utilisateur a déjà accepté l'avertissement
                    if (!localStorage.getItem('hosbac-warning-accepted')) {
                        warningModal.classList.add('active');
                    } else {
                        checkAuthState();
                    }
                }, 800);
            }, 4000);

            // Événements pour les modales
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('active');
                });
            });

            document.getElementById('acceptWarning').addEventListener('click', function() {
                localStorage.setItem('hosbac-warning-accepted', 'true');
                warningModal.classList.remove('active');
                checkAuthState();
            });

            // Navigation
            document.querySelectorAll('.nav-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });

            // Filtres des épreuves
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.getAttribute('data-filter');
                    filterExams(filter);
                });
            });

            // Liens d'authentification
            document.getElementById('showRegisterLink').addEventListener('click', function(e) {
                e.preventDefault();
                loginModal.classList.remove('active');
                registerModal.classList.add('active');
            });

            document.getElementById('showLoginLink').addEventListener('click', function(e) {
                e.preventDefault();
                registerModal.classList.remove('active');
                loginModal.classList.add('active');
            });

            // Formulaires
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('addExamForm').addEventListener('submit', handleAddExam);
            document.getElementById('editProfileForm').addEventListener('submit', handleEditProfile);
            document.getElementById('addExamBtn').addEventListener('click', function() {
                addExamModal.classList.add('active');
            });
            document.getElementById('editProfileBtn').addEventListener('click', function() {
                document.getElementById('editName').value = userData.name;
                document.getElementById('editSchool').value = userData.school;
                document.getElementById('editClass').value = userData.class;
                editProfileModal.classList.add('active');
            });
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('clearAllNotifications').addEventListener('click', clearAllNotifications);

            // Recherche
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // Liens légaux
            document.getElementById('termsLink').addEventListener('click', function(e) {
                e.preventDefault();
                termsModal.classList.add('active');
            });
            document.getElementById('privacyLink').addEventListener('click', function(e) {
                e.preventDefault();
                privacyModal.classList.add('active');
            });
        });

        // Vérification de l'état d'authentification
        function checkAuthState() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                } else {
                    currentUser = null;
                    userData = null;
                    showLoginModal();
                }
            });
        }

        // Chargement des données utilisateur
        function loadUserData() {
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        userData = doc.data();
                        pointsValue.textContent = userData.points || 0;
                        pointsDisplay.style.display = 'flex';
                        
                        // Afficher/masquer l'icône admin
                        if (currentUser.email === 'mickaelpcs14@gmail.com') {
                            document.querySelectorAll('.admin-only').forEach(el => {
                                el.style.display = 'block';
                            });
                        }
                        
                        loadExams();
                        loadNotifications();
                        showPage('home');
                    } else {
                        // Créer un document utilisateur s'il n'existe pas
                        const userRef = db.collection('users').doc(currentUser.uid);
                        userRef.set({
                            name: currentUser.displayName || 'Utilisateur',
                            email: currentUser.email,
                            school: '',
                            class: '',
                            points: 5, // Points initiaux
                            examsCount: 0,
                            downloadsCount: 0,
                            favoritesCount: 0,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        }).then(() => {
                            loadUserData();
                        });
                    }
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des données utilisateur:', error);
                    showMessage('Erreur lors du chargement des données', 'error');
                });
        }

        // Chargement des épreuves
        function loadExams() {
            db.collection('exams')
                .where('approved', '==', true)
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    exams = [];
                    snapshot.forEach(doc => {
                        exams.push({ id: doc.id, ...doc.data() });
                    });
                    displayExams(homeExamsGrid, exams.slice(0, 6));
                    displayExams(examsGrid, exams);
                    
                    // Mettre à jour les statistiques admin si nécessaire
                    if (currentUser && currentUser.email === 'mickaelpcs14@gmail.com') {
                        updateAdminStats();
                        loadAdminExams();
                    }
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des épreuves:', error);
                    showMessage('Erreur lors du chargement des épreuves', 'error');
                });
        }

        // Affichage des épreuves
        function displayExams(container, examsToDisplay) {
            if (examsToDisplay.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>Aucune épreuve disponible pour le moment</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            examsToDisplay.forEach(exam => {
                const examCard = document.createElement('div');
                examCard.className = 'exam-card';
                examCard.innerHTML = `
                    <h3 class="exam-title">${exam.name}</h3>
                    <div class="exam-meta">
                        <span>${exam.subject}</span>
                        <span>${exam.class}</span>
                    </div>
                    <div class="exam-meta">
                        <span>Par ${exam.authorName}</span>
                        <span>${formatDate(exam.createdAt?.toDate())}</span>
                    </div>
                    <div class="exam-actions">
                        <button class="btn btn-primary download-btn" data-id="${exam.id}">
                            <i class="fas fa-download"></i> Télécharger
                        </button>
                        <button class="btn btn-secondary favorite-btn" data-id="${exam.id}">
                            <i class="fas fa-heart"></i> Favori
                        </button>
                    </div>
                    ${currentUser && currentUser.email === 'mickaelpcs14@gmail.com' ? `
                    <div style="margin-top: 10px;">
                        <button class="btn btn-danger delete-exam-btn" data-id="${exam.id}" style="width: 100%;">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                    ` : ''}
                `;
                container.appendChild(examCard);
            });
            
            // Ajouter les événements aux boutons
            container.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examId = this.getAttribute('data-id');
                    downloadExam(examId);
                });
            });
            
            container.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examId = this.getAttribute('data-id');
                    toggleFavorite(examId);
                });
            });
            
            container.querySelectorAll('.delete-exam-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examId = this.getAttribute('data-id');
                    deleteExam(examId);
                });
            });
        }

        // Filtrage des épreuves
        function filterExams(filter) {
            if (filter === 'all') {
                displayExams(examsGrid, exams);
            } else {
                const filteredExams = exams.filter(exam => exam.subject.toLowerCase() === filter);
                displayExams(examsGrid, filteredExams);
            }
        }

        // Recherche d'épreuves
        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (query.length < 2) {
                searchResults.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>Utilisez la barre de recherche pour trouver des épreuves</p>
                    </div>
                `;
                return;
            }
            
            const results = exams.filter(exam => 
                exam.name.toLowerCase().includes(query) ||
                exam.subject.toLowerCase().includes(query) ||
                exam.class.toLowerCase().includes(query) ||
                exam.authorName.toLowerCase().includes(query)
            );
            
            displayExams(searchResults, results);
        }

        // Connexion
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    loginModal.classList.remove('active');
                    showMessage('Connexion réussie!', 'success');
                })
                .catch(error => {
                    console.error('Erreur de connexion:', error);
                    showMessage('Email ou mot de passe incorrect', 'error');
                });
        }

        // Inscription
        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const school = document.getElementById('registerSchool').value;
            const userClass = document.getElementById('registerClass').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showMessage('Les mots de passe ne correspondent pas', 'error');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    
                    // Mettre à jour le profil
                    return user.updateProfile({
                        displayName: name
                    }).then(() => {
                        // Créer le document utilisateur dans Firestore
                        return db.collection('users').doc(user.uid).set({
                            name: name,
                            email: email,
                            school: school,
                            class: userClass,
                            points: 5, // Points initiaux
                            examsCount: 0,
                            downloadsCount: 0,
                            favoritesCount: 0,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
                })
                .then(() => {
                    registerModal.classList.remove('active');
                    showMessage('Inscription réussie! Vous avez reçu 5 points de bienvenue.', 'success');
                })
                .catch(error => {
                    console.error('Erreur d\'inscription:', error);
                    showMessage('Erreur lors de l\'inscription: ' + error.message, 'error');
                });
        }

        // Déconnexion
        function handleLogout() {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    userData = null;
                    pointsDisplay.style.display = 'none';
                    showLoginModal();
                    showMessage('Déconnexion réussie', 'success');
                })
                .catch(error => {
                    console.error('Erreur de déconnexion:', error);
                    showMessage('Erreur lors de la déconnexion', 'error');
                });
        }

        // Ajout d'épreuve
        function handleAddExam(e) {
            e.preventDefault();
            
            const subject = document.getElementById('examSubject').value;
            const examClass = document.getElementById('examClass').value;
            const name = document.getElementById('examName').value;
            const examFile = document.getElementById('examFile').files[0];
            const corrigeFile = document.getElementById('corrigeFile').files[0];
            
            if (!examFile) {
                showMessage('Veuillez sélectionner un fichier PDF pour l\'épreuve', 'error');
                return;
            }
            
            // Vérifier que l'utilisateur a assez de points
            if (userData.points < 1) {
                showMessage('Vous n\'avez pas assez de points pour ajouter une épreuve', 'error');
                return;
            }
            
            // Upload des fichiers vers Cloudinary
            const uploadPromises = [uploadToCloudinary(examFile)];
            if (corrigeFile) {
                uploadPromises.push(uploadToCloudinary(corrigeFile));
            }
            
            Promise.all(uploadPromises)
                .then(results => {
                    const examUrl = results[0].secure_url;
                    const corrigeUrl = results[1] ? results[1].secure_url : null;
                    
                    // Créer le document épreuve dans Firestore
                    return db.collection('exams').add({
                        subject: subject,
                        class: examClass,
                        name: name,
                        examUrl: examUrl,
                        corrigeUrl: corrigeUrl,
                        authorId: currentUser.uid,
                        authorName: userData.name,
                        approved: false, // En attente de modération
                        downloads: 0,
                        favorites: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    // Mettre à jour les points de l'utilisateur
                    return db.collection('users').doc(currentUser.uid).update({
                        points: firebase.firestore.FieldValue.increment(-1)
                    });
                })
                .then(() => {
                    addExamModal.classList.remove('active');
                    document.getElementById('addExamForm').reset();
                    showMessage('Épreuve soumise avec succès! Elle sera visible après approbation.', 'success');
                    loadUserData(); // Recharger les données utilisateur
                })
                .catch(error => {
                    console.error('Erreur lors de l\'ajout de l\'épreuve:', error);
                    showMessage('Erreur lors de l\'ajout de l\'épreuve: ' + error.message, 'error');
                });
        }

        // Upload vers Cloudinary
        function uploadToCloudinary(file) {
            return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', uploadPreset);
                
                fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.secure_url) {
                        resolve(data);
                    } else {
                        reject(new Error('Upload échoué'));
                    }
                })
                .catch(error => {
                    reject(error);
                });
            });
        }

        // Modification du profil
        function handleEditProfile(e) {
            e.preventDefault();
            
            const name = document.getElementById('editName').value;
            const school = document.getElementById('editSchool').value;
            const userClass = document.getElementById('editClass').value;
            
            db.collection('users').doc(currentUser.uid).update({
                name: name,
                school: school,
                class: userClass
            })
            .then(() => {
                editProfileModal.classList.remove('active');
                showMessage('Profil mis à jour avec succès!', 'success');
                loadUserData(); // Recharger les données utilisateur
            })
            .catch(error => {
                console.error('Erreur lors de la mise à jour du profil:', error);
                showMessage('Erreur lors de la mise à jour du profil', 'error');
            });
        }

        // Téléchargement d'épreuve
        function downloadExam(examId) {
            const exam = exams.find(e => e.id === examId);
            
            if (!exam) {
                showMessage('Épreuve non trouvée', 'error');
                return;
            }
            
            // Vérifier si l'utilisateur a assez de points pour télécharger le corrigé
            if (exam.corrigeUrl && userData.points < 2) {
                showMessage('Vous n\'avez pas assez de points pour télécharger le corrigé (2 points requis)', 'error');
                return;
            }
            
            // Ouvrir le PDF dans un nouvel onglet
            window.open(exam.examUrl, '_blank');
            
            // Si l'utilisateur télécharge le corrigé, déduire les points
            if (exam.corrigeUrl) {
                db.collection('users').doc(currentUser.uid).update({
                    points: firebase.firestore.FieldValue.increment(-2)
                })
                .then(() => {
                    // Ajouter des points à l'auteur
                    return db.collection('users').doc(exam.authorId).update({
                        points: firebase.firestore.FieldValue.increment(2)
                    });
                })
                .then(() => {
                    // Mettre à jour le compteur de téléchargements
                    return db.collection('exams').doc(examId).update({
                        downloads: firebase.firestore.FieldValue.increment(1)
                    });
                })
                .then(() => {
                    // Créer une notification pour l'auteur
                    return db.collection('notifications').add({
                        userId: exam.authorId,
                        type: 'download',
                        message: `${userData.name} a téléchargé votre épreuve "${exam.name}"`,
                        examId: examId,
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    showMessage('Corrigé téléchargé! 2 points ont été déduits.', 'success');
                    loadUserData(); // Recharger les données utilisateur
                })
                .catch(error => {
                    console.error('Erreur lors du téléchargement:', error);
                });
            } else {
                // Mettre à jour le compteur de téléchargements pour l'épreuve seule
                db.collection('exams').doc(examId).update({
                    downloads: firebase.firestore.FieldValue.increment(1)
                })
                .then(() => {
                    // Créer une notification pour l'auteur
                    return db.collection('notifications').add({
                        userId: exam.authorId,
                        type: 'download',
                        message: `${userData.name} a téléchargé votre épreuve "${exam.name}"`,
                        examId: examId,
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    showMessage('Épreuve téléchargée avec succès!', 'success');
                })
                .catch(error => {
                    console.error('Erreur lors du téléchargement:', error);
                });
            }
        }

        // Ajout/suppression des favoris
        function toggleFavorite(examId) {
            const exam = exams.find(e => e.id === examId);
            
            if (!exam) {
                showMessage('Épreuve non trouvée', 'error');
                return;
            }
            
            // Vérifier si l'épreuve est déjà en favori
            const userFavorites = userData.favorites || [];
            const isFavorite = userFavorites.includes(examId);
            
            if (isFavorite) {
                // Retirer des favoris
                const updatedFavorites = userFavorites.filter(id => id !== examId);
                
                db.collection('users').doc(currentUser.uid).update({
                    favorites: updatedFavorites
                })
                .then(() => {
                    // Mettre à jour le compteur de favoris de l'épreuve
                    return db.collection('exams').doc(examId).update({
                        favorites: firebase.firestore.FieldValue.increment(-1)
                    });
                })
                .then(() => {
                    showMessage('Épreuve retirée des favoris', 'success');
                    loadUserData(); // Recharger les données utilisateur
                })
                .catch(error => {
                    console.error('Erreur lors de la suppression des favoris:', error);
                });
            } else {
                // Ajouter aux favoris
                userFavorites.push(examId);
                
                db.collection('users').doc(currentUser.uid).update({
                    favorites: userFavorites
                })
                .then(() => {
                    // Mettre à jour le compteur de favoris de l'épreuve
                    return db.collection('exams').doc(examId).update({
                        favorites: firebase.firestore.FieldValue.increment(1)
                    });
                })
                .then(() => {
                    // Créer une notification pour l'auteur
                    return db.collection('notifications').add({
                        userId: exam.authorId,
                        type: 'favorite',
                        message: `${userData.name} a ajouté votre épreuve "${exam.name}" à ses favoris`,
                        examId: examId,
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    showMessage('Épreuve ajoutée aux favoris!', 'success');
                    loadUserData(); // Recharger les données utilisateur
                })
                .catch(error => {
                    console.error('Erreur lors de l\'ajout aux favoris:', error);
                });
            }
        }

        // Suppression d'épreuve (admin uniquement)
        function deleteExam(examId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette épreuve?')) {
                return;
            }
            
            db.collection('exams').doc(examId).delete()
                .then(() => {
                    showMessage('Épreuve supprimée avec succès', 'success');
                    loadExams(); // Recharger les épreuves
                })
                .catch(error => {
                    console.error('Erreur lors de la suppression de l\'épreuve:', error);
                    showMessage('Erreur lors de la suppression de l\'épreuve', 'error');
                });
        }

        // Chargement des notifications
        function loadNotifications() {
            db.collection('notifications')
                .where('userId', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    notifications = [];
                    snapshot.forEach(doc => {
                        notifications.push({ id: doc.id, ...doc.data() });
                    });
                    displayNotifications();
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des notifications:', error);
                });
        }

        // Affichage des notifications
        function displayNotifications() {
            if (notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <p>Aucune notification pour le moment</p>
                    </div>
                `;
                return;
            }
            
            notificationsList.innerHTML = '';
            notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = 'notification-item';
                notificationItem.innerHTML = `
                    <div class="notification-content">
                        <p>${notification.message}</p>
                        <small>${formatDate(notification.createdAt?.toDate())}</small>
                    </div>
                    <div class="notification-actions">
                        <button class="btn btn-secondary delete-notification-btn" data-id="${notification.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                notificationsList.appendChild(notificationItem);
            });
            
            // Ajouter les événements aux boutons de suppression
            notificationsList.querySelectorAll('.delete-notification-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const notificationId = this.getAttribute('data-id');
                    deleteNotification(notificationId);
                });
            });
        }

        // Suppression d'une notification
        function deleteNotification(notificationId) {
            db.collection('notifications').doc(notificationId).delete()
                .then(() => {
                    loadNotifications(); // Recharger les notifications
                })
                .catch(error => {
                    console.error('Erreur lors de la suppression de la notification:', error);
                });
        }

        // Suppression de toutes les notifications
        function clearAllNotifications() {
            if (notifications.length === 0) return;
            
            const batch = db.batch();
            notifications.forEach(notification => {
                const ref = db.collection('notifications').doc(notification.id);
                batch.delete(ref);
            });
            
            batch.commit()
                .then(() => {
                    loadNotifications(); // Recharger les notifications
                    showMessage('Toutes les notifications ont été supprimées', 'success');
                })
                .catch(error => {
                    console.error('Erreur lors de la suppression des notifications:', error);
                });
        }

        // Chargement des épreuves en attente (admin)
        function loadAdminExams() {
            db.collection('exams')
                .where('approved', '==', false)
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const pendingExams = [];
                    snapshot.forEach(doc => {
                        pendingExams.push({ id: doc.id, ...doc.data() });
                    });
                    displayAdminExams(pendingExams);
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des épreuves en attente:', error);
                });
        }

        // Affichage des épreuves en attente (admin)
        function displayAdminExams(pendingExams) {
            if (pendingExams.length === 0) {
                adminExamsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>Aucune épreuve en attente de modération</p>
                    </div>
                `;
                return;
            }
            
            adminExamsList.innerHTML = '';
            pendingExams.forEach(exam => {
                const examCard = document.createElement('div');
                examCard.className = 'exam-card';
                examCard.innerHTML = `
                    <h3 class="exam-title">${exam.name}</h3>
                    <div class="exam-meta">
                        <span>${exam.subject}</span>
                        <span>${exam.class}</span>
                    </div>
                    <div class="exam-meta">
                        <span>Par ${exam.authorName}</span>
                        <span>${formatDate(exam.createdAt?.toDate())}</span>
                    </div>
                    <div class="exam-actions">
                        <button class="btn btn-success approve-exam-btn" data-id="${exam.id}">
                            <i class="fas fa-check"></i> Approuver
                        </button>
                        <button class="btn btn-danger reject-exam-btn" data-id="${exam.id}">
                            <i class="fas fa-times"></i> Rejeter
                        </button>
                    </div>
                `;
                adminExamsList.appendChild(examCard);
            });
            
            // Ajouter les événements aux boutons
            adminExamsList.querySelectorAll('.approve-exam-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examId = this.getAttribute('data-id');
                    approveExam(examId);
                });
            });
            
            adminExamsList.querySelectorAll('.reject-exam-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examId = this.getAttribute('data-id');
                    rejectExam(examId);
                });
            });
        }

        // Approbation d'épreuve (admin)
        function approveExam(examId) {
            db.collection('exams').doc(examId).update({
                approved: true
            })
            .then(() => {
                // Ajouter des points à l'auteur
                const exam = exams.find(e => e.id === examId);
                if (exam) {
                    return db.collection('users').doc(exam.authorId).update({
                        points: firebase.firestore.FieldValue.increment(exam.corrigeUrl ? 4 : 1)
                    });
                }
            })
            .then(() => {
                showMessage('Épreuve approuvée avec succès', 'success');
                loadAdminExams(); // Recharger les épreuves en attente
                loadExams(); // Recharger toutes les épreuves
            })
            .catch(error => {
                console.error('Erreur lors de l\'approbation de l\'épreuve:', error);
                showMessage('Erreur lors de l\'approbation de l\'épreuve', 'error');
            });
        }

        // Rejet d'épreuve (admin)
        function rejectExam(examId) {
            if (!confirm('Êtes-vous sûr de vouloir rejeter cette épreuve?')) {
                return;
            }
            
            db.collection('exams').doc(examId).delete()
                .then(() => {
                    showMessage('Épreuve rejetée avec succès', 'success');
                    loadAdminExams(); // Recharger les épreuves en attente
                })
                .catch(error => {
                    console.error('Erreur lors du rejet de l\'épreuve:', error);
                    showMessage('Erreur lors du rejet de l\'épreuve', 'error');
                });
        }

        // Mise à jour des statistiques admin
        function updateAdminStats() {
            // Compter les utilisateurs
            db.collection('users').get()
                .then(snapshot => {
                    adminUsers.textContent = snapshot.size;
                });
            
            // Compter les épreuves
            db.collection('exams').get()
                .then(snapshot => {
                    adminExams.textContent = snapshot.size;
                });
            
            // Compter les épreuves en attente
            db.collection('exams').where('approved', '==', false).get()
                .then(snapshot => {
                    adminPending.textContent = snapshot.size;
                });
            
            // Compter les téléchargements totaux
            let totalDownloads = 0;
            db.collection('exams').get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        totalDownloads += doc.data().downloads || 0;
                    });
                    adminDownloads.textContent = totalDownloads;
                });
        }

        // Affichage d'une page
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-icon').forEach(icon => {
                icon.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`.nav-icon[data-page="${pageId}"]`).classList.add('active');
            
            // Charger les données spécifiques à la page si nécessaire
            if (pageId === 'profile' && userData) {
                displayUserProfile();
            }
        }

        // Affichage du profil utilisateur
        function displayUserProfile() {
            // Afficher les informations utilisateur
            userInfo.innerHTML = `
                <p><strong>Nom:</strong> ${userData.name}</p>
                <p><strong>Email:</strong> ${userData.email}</p>
                <p><strong>École:</strong> ${userData.school || 'Non spécifiée'}</p>
                <p><strong>Classe:</strong> ${userData.class || 'Non spécifiée'}</p>
            `;
            
            // Mettre à jour les statistiques
            userPoints.textContent = userData.points || 0;
            userExams.textContent = userData.examsCount || 0;
            userDownloads.textContent = userData.downloadsCount || 0;
            userFavorites.textContent = userData.favoritesCount || 0;
            
            // Afficher les favoris
            const userFavorites = userData.favorites || [];
            if (userFavorites.length === 0) {
                userFavoritesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <p>Aucune épreuve en favori</p>
                    </div>
                `;
            } else {
                const favoriteExams = exams.filter(exam => userFavorites.includes(exam.id));
                displayExams(userFavoritesList, favoriteExams);
            }
        }

        // Affichage de la modale de connexion
        function showLoginModal() {
            loginModal.classList.add('active');
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
        }

        // Affichage des messages
        function showMessage(message, type) {
            // Créer un élément de message
            const messageEl = document.createElement('div');
            messageEl.className = `glass-card message-${type}`;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            messageEl.innerHTML = `
                <p>${message}</p>
            `;
            
            document.body.appendChild(messageEl);
            
            // Supprimer le message après 3 secondes
            setTimeout(() => {
                messageEl.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(messageEl);
                }, 300);
            }, 3000);
            
            // Ajouter les styles d'animation si nécessaire
            if (!document.querySelector('#messageStyles')) {
                const styleEl = document.createElement('style');
                styleEl.id = 'messageStyles';
                styleEl.innerHTML = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                    .message-success { border-left: 4px solid #43a047; }
                    .message-error { border-left: 4px solid #e53935; }
                `;
                document.head.appendChild(styleEl);
            }
        }

        // Formatage de la date
        function formatDate(date) {
            if (!date) return 'Date inconnue';
            
            const now = new Date();
            const diff = now.getTime() - date.getTime();
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (days === 0) {
                return "Aujourd'hui";
            } else if (days === 1) {
                return "Hier";
            } else if (days < 7) {
                return `Il y a ${days} jours`;
            } else {
                return date.toLocaleDateString('fr-FR');
            }
        }
    </script>
</body>
</html>
